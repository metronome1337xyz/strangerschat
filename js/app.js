angular.module("myApp",["ui.router","MyServices","MyControllers","ngMaterial","ngHamburger","ngMdIcons","ngStorage"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("register",{url:"/register",views:{mainArea:{templateUrl:"templates/register.html",controller:"loginRegisterController"}}}).state("login",{url:"/login",views:{mainArea:{templateUrl:"templates/login.html",controller:"loginRegisterController"}}}).state("main",{views:{mainArea:{templateUrl:"templates/main.html",controller:"mainController"}},resolve:{session_data:["loginRegisterLogout","$q",function(e,t){var r=t.defer();return e.checkLogin().then(function(e){r.resolve(e)}),r.promise}],namesList_data:["chatsService","$q",function(e,t){var r=t.defer();return e.getNamesList().then(function(e){r.resolve(e)}),r.promise}],admin_convo:["chatsService","$q",function(e,t){var r=t.defer();return e.getAdminConversation().then(function(e){r.resolve(e)}),r.promise}]}}).state("main.chats",{url:"/chats",views:{mainArea:{templateUrl:"templates/chats.html",controller:"chatsController"}}}).state("main.chats.user",{url:"/:name",views:{chatsContentView:{templateUrl:"templates/main.chats.user.html"}}}),t.otherwise("/login")}]).config(["$mdThemingProvider",function(e){e.theme("default").primaryPalette("purple",{"default":"900","hue-1":"50","hue-2":"600","hue-3":"A100"}).accentPalette("light-green",{"default":"A400"})}]),angular.module("MyControllers",[]).controller("mainController",["$scope","loginRegisterLogout","chatsService","namesList_data","admin_convo","$localStorage","session_data","$state",function(e,t,r,n,o,s,i,a){if(console.log("main controller fired"),e.storage=s,e.storage.clickedName){var c={name:e.storage.clickedName};r.getConversation(c).then(function(t){t.length?e.convo=t.slice().reverse():e.convo=null})}else o.length?e.convo=o.slice().reverse():e.convo=null;i.logged_in?(t.setChatsData(i.name),n.usersFound?(r.setNamesList(n),a.go("main.chats")):a.go("main.chats")):a.go("login")}]).controller("loginRegisterController",["$scope","$state","chatsService","loginRegisterLogout",function(e,t,r,n){console.log("login controller fired"),e.createAccount=function(e,r,o,s){var i={name:e,username:r,email:o,password:s};n.registerUser(i).then(function(e){e.search("true")?t.go("login"):alert("Error")})},e.login=function(e,r){var o={username:e,password:r};n.userLogin(o).then(function(e){e.logged_in?t.go("main"):alert("wrong input")})}}]).controller("chatsController",["$scope","loginRegisterLogout","chatsService","$localStorage","$state",function(e,t,r,n,o){e.name=t.name,e.storage=n,e.storage.selectedUser||(e.storage.selectedUser={item:-1}),e.storage.clickedName||o.go("main.chats.user",{name:e.name}),e.storage.clickedName&&o.go("main.chats.user",{name:e.storage.clickedName}),e.logout=function(){t.userLogout(),n.$reset(),o.go("login")},e.tgState=!0,e.toggleSideMenu=function(){e.tgState=!e.tgState},e.namesList=r.namesList,e.getConvo=function(t){e.clickedName=t,e.storage.clickedName=e.clickedName;var t={name:t};r.getConversation(t).then(function(t){t.length?e.convo=t.slice().reverse():e.convo=null})},e.postComment=function(t){var n={to_user:e.clickedName,comment:t};r.sendComment(n).then(function(t){e.getConvo(e.clickedName)})},e.isOpen=!1,e.demo={isOpen:!1,count:0,selectedMode:"md-scale",selectedDirection:"left"},e.editComment=function(t,n){var o={message_id:e.convo[t].message_id,newComment:n};r.updateComment(o).then(function(t){t&&e.getConvo(e.clickedName)})},e.deleteComment=function(t){var n={message_id:e.convo[t].message_id};r.deleteComment(n).then(function(t){e.getConvo(e.clickedName)})}}]),angular.module("MyServices",[]).factory("loginRegisterLogout",["$http","$state","$q",function(e,t,r){var n={};return n.registerUser=function(t){var n=r.defer();return e.post("server/createAccount.php",t).success(function(e){n.resolve(e)}).error(function(e){alert(e)}),n.promise},n.userLogin=function(t){var n=r.defer();return e.post("server/login.php",t).success(function(e){n.resolve(e)}).error(function(e){n.reject("Error"+e)}),n.promise},n.checkLogin=function(){var t=r.defer();return e.get("server/checkLogin.php").success(function(e){t.resolve(e)}).error(function(e){alert(JSON.stringify(e))}),t.promise},n.userLogout=function(){e.get("server/logout.php").success(function(e){-1!=e.search("Logout")&&t.go("login")}).error(function(e){alert(JSON.stringify(e))})},n.setChatsData=function(e){n.name=e},n}]).factory("chatsService",["$http","$state","$q",function(e,t,r){var n={};return n.getNamesList=function(){var t=r.defer();return e.get("server/getUsers.php").success(function(e){t.resolve(e)}).error(function(e){alert(JSON.stringify(e))}),t.promise},n.setNamesList=function(e){n.namesList=e},n.sendComment=function(t){var n=r.defer();return e.post("server/storeUserMessage.php",t).success(function(e){n.resolve(e)}).error(function(e){n.reject("Error"+e)}),n.promise},n.getConversation=function(t){var n=r.defer();return e.post("server/getConvo.php",t).success(function(e){n.resolve(e)}).error(function(e){alert(JSON.stringify(e))}),n.promise},n.getAdminConversation=function(){var t=r.defer();return e.post("server/getAdminConvo.php",name).success(function(e){t.resolve(e)}).error(function(e){alert(JSON.stringify(e))}),t.promise},n.deleteComment=function(t){var n=r.defer();return e.post("server/deleteComment.php",t).success(function(e){n.resolve(e)}).error(function(e){alert(JSON.stringify(e))}),n.promise},n.updateComment=function(t){var n=r.defer();return e.post("server/updateComment.php",t).success(function(e){n.resolve(e)}).error(function(e){alert(JSON.stringify(alert))}),n.promise},n}]);